<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Computer Vision Portfolio — 4 Columns</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="site-header">
    <div class="wrap header-grid">
      <div>
        <h1 id="site-title"></h1>
        <p id="site-subtitle" class="subtitle"></p>
      </div>
      <nav class="top-nav" aria-label="Jump to category">
        <a href="#col-mvg">Multi-view Geometry</a>
        <a href="#col-track">Tracking / Segmentation</a>
        <a href="#col-pc">Point-cloud Analysis</a>
        <a href="#col-genai">GenAI</a>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <section id="about" class="card"></section>

    <!-- Four columns -->
    <section class="card columns">
      <div class="col" id="col-mvg"><h2>Multi-view Geometry</h2><div class="col-grid" id="col-mvg-grid"></div></div>
      <div class="col" id="col-track"><h2>Tracking / Segmentation</h2><div class="col-grid" id="col-track-grid"></div></div>
      <div class="col" id="col-pc"><h2>Point-cloud Analysis</h2><div class="col-grid" id="col-pc-grid"></div></div>
      <div class="col" id="col-genai"><h2>GenAI</h2><div class="col-grid" id="col-genai-grid"></div></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <small>© 2025 Computer Vision Portfolio</small>
    </div>
  </footer>

  <!-- Modal (image/video viewer) -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-body">
      <button class="close-btn" id="modalClose">✕</button>
      <div id="modalContent"></div>
    </div>
    <div id="modalOverlay" class="overlay"></div>
  </div>

  <script src="content.js"></script>
  <script>
    // helper: escape for plain text (we allow HTML in description intentionally)
    function esc(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function youTubeThumb(id){ return `https://img.youtube.com/vi/${id}/hqdefault.jpg`; }

    // DOM refs
    const titleEl = document.getElementById("site-title");
    const subtitleEl = document.getElementById("site-subtitle");
    const aboutEl = document.getElementById("about");
    const colMVG = document.getElementById("col-mvg-grid");
    const colTrack = document.getElementById("col-track-grid");
    const colPC = document.getElementById("col-pc-grid");
    const colGen = document.getElementById("col-genai-grid");

    // populate header and about
    titleEl.textContent = CONTENT.title;
    subtitleEl.textContent = CONTENT.tagline || '';
    (CONTENT.about || []).forEach(p=>{
      const para = document.createElement("p");
      para.innerHTML = p; // allow simple HTML tags in about paragraphs
      aboutEl.appendChild(para);
    });

    // map category -> container
    const colMap = {
      "multiview": colMVG,
      "tracking": colTrack,
      "pointcloud": colPC,
      "genai": colGen
    };

    // helper to create project card
    function makeProjectCard(proj){
      const card = document.createElement("article");
      card.className = "project-card";

      const thumbHtml = (proj.images && proj.images.length) ? `
        <div class="proj-gallery">
          ${proj.images.slice(0,2).map(im => `<img class="proj-thumb" src="${esc(im.src)}" data-src="${esc(im.src)}" data-alt="${esc(im.alt||proj.title)}">`).join('')}
        </div>` : `<div class="proj-no-image">No image</div>`;

      const videoBtn = proj.videoId ? `<button class="btn play-btn" data-video="${esc(proj.videoId)}">▶ Demo</button>` : '';
      const linkBtn = proj.link ? `<a class="btn link-btn" href="${esc(proj.link)}" target="_blank" rel="noopener">Project</a>` : '';

      // allow basic HTML in description
      card.innerHTML = `
        <div class="card-left">${thumbHtml}</div>
        <div class="card-right">
          <h3>${esc(proj.title)}</h3>
          <div class="proj-desc">${proj.description || ''}</div>
          <div class="proj-tags">${(proj.tags||[]).map(t=>`<span class="tag">${esc(t)}</span>`).join(' ')}</div>
          <div class="proj-actions">${videoBtn} ${linkBtn}</div>
        </div>
      `;
      return card;
    }

    // render all projects into appropriate columns
    (CONTENT.projects || []).forEach(proj => {
      const cat = (proj.category || '').toLowerCase();
      const target = colMap[cat];
      const card = makeProjectCard(proj);
      if(target) target.appendChild(card);
      else {
        // if category not recognized, append to first column
        colMVG.appendChild(card);
      }
    });

    // modal logic (image & video)
    const modal = document.getElementById("modal");
    const modalContent = document.getElementById("modalContent");
    const modalClose = document.getElementById("modalClose");
    const modalOverlay = document.getElementById("modalOverlay");

    function openImage(src, alt){
      modalContent.innerHTML = `<img class="modal-img" src="${src}" alt="${esc(alt)}">`;
      modal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function openVideo(id){
      modalContent.innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${id}?autoplay=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
      modal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }
    function closeModal(){
      modalContent.innerHTML = "";
      modal.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }
    modalClose.addEventListener('click', closeModal);
    modalOverlay.addEventListener('click', closeModal);
    document.addEventListener('keydown', e => { if(e.key === 'Escape') closeModal(); });

    // delegated clicks: thumbs and play buttons
    document.body.addEventListener('click', e=>{
      const t = e.target;
      if(t.classList.contains('proj-thumb')) openImage(t.dataset.src || t.src, t.dataset.alt || '');
      if(t.classList.contains('play-btn')) openVideo(t.dataset.video);
    });
  </script>
</body>
</html>
