<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Computer Vision Portfolio</title>
  <link rel="stylesheet" href="styles.css"/>
</head>

<body>
  <header class="site-header">
    <div class="wrap">
      <h1 id="site-title"></h1>
      <p id="site-subtitle" class="subtitle"></p>
    </div>
  </header>

  <main class="wrap" id="main">
    <section id="about" class="card"></section>

    <section class="card">
      <h2>Projects</h2>
      <div id="projects-grid" class="projects-grid"></div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <small>© 2025 Computer Vision Portfolio</small>
    </div>
  </footer>

  <!-- Modal (image/video viewer) -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-body">
      <button class="close-btn" id="modalClose">✕</button>
      <div id="modalContent"></div>
    </div>
    <div id="modalOverlay" class="overlay"></div>
  </div>

  <script src="content.js"></script>
  <script>
    // Escape helper
    function esc(s){ return String(s || '').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function youTubeThumb(id){ return `https://img.youtube.com/vi/${id}/hqdefault.jpg`; }

    const titleEl = document.getElementById("site-title");
    const subtitleEl = document.getElementById("site-subtitle");
    const aboutEl = document.getElementById("about");
    const grid = document.getElementById("projects-grid");

    // Fill header
    titleEl.textContent = CONTENT.title;
    subtitleEl.textContent = CONTENT.tagline;

    // About section
    CONTENT.about.forEach(p => {
      const para = document.createElement("p");
      para.innerHTML = esc(p);
      aboutEl.appendChild(para);
    });

    // Render projects
    CONTENT.projects.forEach((proj) => {
      const card = document.createElement("article");
      card.className = "project-card";

      const galleryHtml = proj.images.map((img, idx) => `
        <img class="proj-thumb" src="${esc(img.src)}"
             data-src="${esc(img.src)}" data-alt="${esc(img.alt||proj.title)}"/>
      `).join("");

      const videoButton = proj.videoId
        ? `<button class="btn play-btn" data-video="${esc(proj.videoId)}">▶ Demo Video</button>`
        : "";

      const linkButton = proj.link
        ? `<a class="btn link-btn" href="${esc(proj.link)}" target="_blank">GitHub</a>`
        : "";

      card.innerHTML = `
        <div class="proj-left">
          <div class="proj-gallery">${galleryHtml}</div>
        </div>
        <div class="proj-right">
          <h3>${esc(proj.title)}</h3>
          <div class="proj-desc">${proj.description}</div>
          <div class="proj-meta">${videoButton} ${linkButton}</div>
        </div>
      `;

      grid.appendChild(card);
    });

    // Modal logic
    const modal = document.getElementById("modal");
    const modalContent = document.getElementById("modalContent");
    const modalClose = document.getElementById("modalClose");
    const modalOverlay = document.getElementById("modalOverlay");

    function openImage(src, alt){
      modalContent.innerHTML = `<img class="modal-img" src="${src}" alt="${alt}"/>`;
      modal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    function openVideo(id){
      modalContent.innerHTML = `
        <iframe width="100%" height="100%"
        src="https://www.youtube.com/embed/${id}?autoplay=1"
        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen>
        </iframe>`;
      modal.setAttribute("aria-hidden","false");
      document.body.style.overflow = "hidden";
    }

    modalClose.onclick = closeModal;
    modalOverlay.onclick = closeModal;

    function closeModal(){
      modalContent.innerHTML = "";
      modal.setAttribute("aria-hidden","true");
      document.body.style.overflow = "";
    }

    document.body.addEventListener("click", (e)=>{
      if(e.target.classList.contains("proj-thumb")){
        openImage(e.target.dataset.src, e.target.dataset.alt);
      }
      if(e.target.classList.contains("play-btn")){
        openVideo(e.target.dataset.video);
      }
    });

  </script>
</body>
</html>
